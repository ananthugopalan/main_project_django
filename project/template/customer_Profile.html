{%load static%}
{% load cart_tags %}
<!DOCTYPE html>
<html lang="en">

<head>
    <title>AgriSelect-Customer Profile</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="{% static 'img/Agriselect1.png' %}" width='30' height='30'>

    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/templatemo.css' %}">
    <link rel="stylesheet" href="{% static 'css/custom.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    <!-- Load fonts style after rendering the layout styles -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;700;900&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        .custom-dropdown-width {
            width: 300px; /* Adjust the width as needed */
        }

    </style>
</head>

<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-light shadow p-0 sticky-top">
        <div class="container d-flex justify-content-between align-items-center">
            
            <img src="{% static 'img/Agriselect1.png'%}" width='100' height='auto' class='logo'>

            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#templatemo_main_nav" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="align-self-center collapse navbar-collapse flex-fill  d-lg-flex justify-content-lg-between" id="templatemo_main_nav">
                <div class="flex-fill">
                    <ul class="nav navbar-nav d-flex justify-content-between mx-lg-auto custom-nav-links">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'index' %}">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">About</a>
                        </li>
                        {% if user.is_authenticated %}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'customer_allProducts' %}">All Products</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Orders</a>
                        </li>
                        {%else%}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'user_login' %}">All Products</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'user_login' %}">Orders</a>
                        </li>         
                        {% endif %}             
                        <li class="nav-item">
                            <a class="nav-link" href="#">Contact</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Gallery</a>
                        </li>
                    </ul>
                </div>
                <div class="navbar align-self-center d-flex">
                    <div class="d-lg-none flex-sm-fill mt-3 mb-4 col-7 col-sm-auto pr-3">
                        <div class="dropdown" >
                            <button class="btn border-0 mt-2" type="button" id="searchDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fa fa-fw fa-search"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end custom-dropdown-width mt-3" id="searchDropdown" aria-labelledby="searchDropdown" >
                                <li>
                                    <form id="search-form" class="px-4 py-3">
                                        <div class="mb-3 d-flex">
                                            <input type="text" class="form-control me-2" id="inputModalSearch" name="q" placeholder="Search ...">
                                        
                                        <button type="submit" class="btn btn-primary"><i class="fa fa-fw fa-search"></i></button></div>
                                        <div id="search-results"></div>
                                    </form>
                                </li>
                            </ul>
                        </div>
                    </div>
                    {% if user.is_authenticated %}
                    <a class="nav-icon position-relative text-decoration-none" href="{% url 'cart' %}">
                        <i class="fa fa-fw fa-shopping-cart text-dark mr-1"></i>
                        <span class="badge bg-danger position-absolute top-0 start-100 translate-middle">
                            {% cart_item_count request.user %}
                        </span>
                    </a>
                    {%else%}
                    <a class="nav-icon position-relative text-decoration-none" href="{% url 'user_login' %}">
                        <i class="fa fa-fw fa-shopping-cart text-dark mr-1"></i>
                    </a>
                    {% endif %}
                    <a class="nav-icon position-relative text-decoration-none dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-fw fa-user text-dark mr-3"></i>
                    </a>
                    <div class="dropdown-menu" aria-labelledby="userDropdown">
                        {% if request.user.is_authenticated %}
                            <a class="dropdown-item text-success" href="#">{{ request.user.first_name }}</a>
                            <a class="dropdown-item" href="{% url 'customer_Profile' %}">Profile</a>
                            <a class="dropdown-item" href="{% url 'customer_Wishlist' %}">Wishlist</a>
                            <a class="dropdown-item" href="{% url 'user_logout' %}" onclick="return confirm('Are you sure you want to sign out?')">Sign out</a>
                        {% else %}  
                            <a class="dropdown-item" href="{% url 'user_login' %}">Sign in</a>
                            <a class="dropdown-item" href="{% url 'customer_Registration' %}">Register</a>
                            <a class="dropdown-item" href="{% url 'seller_home' %}">Seller's Home</a>
                        {% endif %}

                    </div>
                </div>
            </div>
        </div>
    </nav>
    <!-- Close Header -->


    <!--nav ends -->

    {% if messages %}
    <div class="messages">
      {% for message in messages %}
        <div class="alert alert-success">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

 <div class="container ">
    <div class="row ">
        <!-- Sidebar -->
        <div class="col-lg-3 mb-4 mt-5 vh-100 d-flex flex-column shadow-lg" style="background-color: #F8F9F9">
            <!-- Profile Picture -->
            <div class="text-center p-4">
                <img src="{% static 'img/avatar.png' %}" alt="Profile Picture" class="img-fluid rounded-circle mb-3 mt-4" width="100">
                <!-- Greeting -->
                <p class="mb-0"><b>Hello!</b></p>
            </div>
            <div class="list-group mt-3 flex-grow-1">
                <a href="javascript:void(0);" class="list-group-item list-group-item-action mb-2" onclick="showProfileForm()">Dashboard</a>
                <a href="javascript:void(0);" class="list-group-item list-group-item-action mb-2" onclick="showAddressCards()">My Addresses</a>
                <a href="#" class="list-group-item list-group-item-action mb-2">My Gifts</a>
                <a href="#" class="list-group-item list-group-item-action mb-2">Payments</a>
                <!-- Add more sidebar items as needed -->
            </div>
        </div>
        
        <div class="col-lg-9 mt-5 shadow-lg vh-100"  style="background-color: #ffffff;">
            <!-- Main Content -->    
                <!-- Form START -->
                <div id="profile-form-section">
                    <form method="POST" class="file-upload mt-1 " action="{% url 'customer_Profile' %}" id="profile-form">
                    {% csrf_token %}
                    <div class="row mb-5 gx-5">
                        <!-- Contact detail -->
                        <div class="col-xxl-8 mb-5 mb-xxl-0">
                            <div class="bg-secondary-soft px-4 py-5 rounded">
                                <div class="row g-3">
                                    <h5 class="mb-4 mt-0">Personal Details</h5>
                
                                    <!-- First Name -->
                                    <div class="col-md-6">
                                        <label class="form-label">First Name *</label>
                                        <input type="text" class="form-control" id="first_name" name="first_name" placeholder="Enter your First Name" value="{% if request.user.is_authenticated %}{{ request.user.first_name }}{% endif %}" disabled>
                                        <div id="first_name_error" class="text-danger"></div>
                                    </div>
                
                                    <!-- Last Name -->
                                    <div class="col-md-6">
                                        <label class="form-label">Last Name *</label>
                                        <input type="text" class="form-control" id="last_name" name="last_name" placeholder="Enter your Last Name" value="{% if request.user.is_authenticated %}{{ request.user.last_name }}{% endif %}" disabled>
                                        <div id="last_name_error" class="text-danger"></div>
                                    </div>
                                </div> <!-- Row 1 END -->
                
                                <!-- Space -->
                                <div class="mb-3"></div>
                
                                <!-- Mobile number -->
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Mobile number *</label>
                                        <input type="text" class="form-control" id="mobile_number" name="mobile_number" placeholder="Enter your mobile no." value="{% if form_submitted %}{{ request.POST.mobile_number }}{% else %}{{ user_profile.mobile_number }}{% endif %}" {% if not form_submitted %}disabled{% endif %}>
                                        <div id="mobile_number_error" class="text-danger"></div>
                                    </div>
                                </div> <!-- Row 2 END -->
                
                                <!-- Space -->
                                <div class="mb-3"></div>
                
                                <!-- Email -->
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="inputEmail4" class="form-label">Email *</label>
                                        <input type="email" class="form-control" id="inputEmail4" name="email" value="{% if request.user.is_authenticated %}{{ request.user.email }}{% endif %}" disabled>
                                    </div>
                                </div> <!-- Row 3 END -->
                
                                <!-- Add margin to move buttons up -->
                                <div class="mt-3"></div>
                
                                <div class="gap-3 d-md-flex justify-content-md-center text-center">
                                    <button type="submit" class="btn btn-danger btn" id="save_button" name="profile_save_button">Save</button>
                                    <button type="submit" class="btn btn-primary btn" id="update_button">Update</button>
                                </div>
                                
                            </div>
                        </div>
                    </div> <!-- Row END -->
                    </form>
                    <!-- Form END -->
                </div>

            <!-- Address Form Card Template (hidden) -->
            <div id="address-form-card-template" style="display: none">
                <div class="flex-wrap" style="margin-left: 15px;" id="add-address-btn">
                    <button type="button" class="btn btn-primary mt-5 ms-3 me-2" id="show-address-form-button">Add Address</button>
                </div>           
                <div class="flex-wrap" style="margin-left: 15px;" id="address-card-display"> 
                    {% block content %}
                    {% for i in addresses %}
                    <div class="card mt-3" style="width: 200px; margin-right: 20px;" id="address-card-{{ i.id }}">
                        <div class="card-body">                            
                            <strong>{{ i.address_type }}</strong><br>
                            <p id="card_building" style="margin-bottom: 2px;">Building: {{ i.building_name }}</p>
                            <p id="card_street" style="margin-bottom: 2px;">Street: {{ i.street }}</p>
                            <p id="card_city" style="margin-bottom: 2px;">City: {{ i.city }}</p>
                            <p id="card_zip-code" style="margin-bottom: 2px;">Zip Code: {{ i.zip_code }}</p>
                            <div class="mt-3 d-flex">
                                <button class="btn btn-primary btn-sm me-4 edit-address-button"
                                data-address-id="{{ i.id }}"
                                data-building-name="{{ i.building_name }}"
                                data-address-type="{{ i.address_type }}"
                                data-street="{{ i.street }}"
                                data-city="{{ i.city }}"
                                data-state="{{ i.state }}"
                                data-zip-code="{{ i.zip_code }}">
                            <i class="fas fa-edit"></i>
                        </button>                                
                        <button class="btn btn-danger btn-sm" onclick="deleteAddress('{{ i.id }}')"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% endblock %}
                </div>
                
                <div class="card mt-5" style="max-width: 400px; margin: 0 auto; display: none;" id="edit-address-form">
                    <div class="card-body" >
                        <h5>Edit Address</h5>
                        <form method="post" action="{% url 'update_address' %}" id="update-form" onsubmit="return updateAddress()">
                            {% csrf_token %}
                            <input type="hidden" id="address_id" name="address_id" value="{{ address.id }}" />
                            <div class="mb-1">
                                <label for="building_name" class="form-label">Building Name</label>
                                <input type="text" class="form-control" id="building_name" name="building_name" value="{{ address.building_name }}" required>
                            </div>
                            <div class="mb-1">
                                <label for="address_type" class="form-label">Address Type</label>
                                <select class="form-select" id="address_type" name="address_type" required>
                                    <option value="Home" {% if address.address_type == 'Home' %}selected{% endif %}>Home</option>
                                    <option value="Work" {% if address.address_type == 'Work' %}selected{% endif %}>Work</option>
                                    <option value="Other" {% if address.address_type == 'Other' %}selected{% endif %}>Other</option>
                                </select>
                            </div>
                            <div class="d-flex">
                                <div class="mb-1 me-2">
                                    <label for="street" class="form-label">Street</label>
                                    <input type="text" class="form-control" id="street" name="street" value="{{ address.street }}" required>
                                </div>
                                <div class="mb-1">
                                    <label for="city" class="form-label">City</label>
                                    <input type="text" class="form-control" id="city" name="city" value="{{ address.city }}" required>
                                </div>
                            </div>
                            <div class="mb-1">
                                <label for="state" class="form-label">State</label>
                                <input type="text" class="form-control" id="state" name="state" value="{{ address.state }}" required>
                            </div>
                            <div class="mb-1">
                                <label for="zip_code" class="form-label">ZIP Code</label>
                                <input type="text" class="form-control" id="zip_code" name="zip_code" value="{{ address.zip_code }}" required pattern="[0-9]{6}">
                            </div>
                            <button type="submit" class="btn btn-primary" name="update_address_form">Save Changes</button>
                        </form>
                    </div>
                </div>


                <div class="card mt-2" style="max-width: 400px; margin: 0 auto; display: none;" id="address-cards-container">
                    <div class="card-body" >
                        <h5 class="card-title">Add New Address</h5>
                        <form method="post" id="address-form" onsubmit="return addAddress()">
                            {% csrf_token %}
                            <div class="mb-1">
                                <label for="building_name" class="form-label">Building Name</label>
                                <input type="text" class="form-control" id="building_name" name="building_name" required>
                                <span id="buildingNameError" class="text-danger" style="font-size: 10px;"></span>
                            </div>
                            <div class="mb-1">
                                <label for="address_type" class="form-label">Address Type</label>
                                <select class="form-select" id="address_type" name="address_type" required>
                                    <option value="" disabled selected>--Select--</option>
                                    <option value="Home">Home</option>
                                    <option value="Work">Work</option>
                                    <option value="Other">Other</option>
                                </select>
                                <span id="addressTypeError" class="text-danger" style="font-size: 10px;"></span>
                            </div>
                            <div class="d-flex">
                                <div class="mb-1 me-2">
                                    <label for="street" class="form-label">Street</label>
                                    <input type="text" class="form-control" id="street" name="street" required>
                                    <span id="streetError" class="text-danger" style="font-size: 10px;"></span>
                                </div>
                                <div class="mb-1">
                                    <label for="city" class="form-label">City</label>
                                    <input type="text" class="form-control" id="city" name="city" required>
                                    <span id="cityError" class="text-danger" style="font-size: 10px;"></span>
                                </div>
                            </div>
                            <div class="d-flex">
                                <div class="mb-1 me-2">
                                    <label for="state" class="form-label">State</label>
                                    <input type="text" class="form-control" id="state" name="state" required>
                                    <span id="stateError" class="text-danger" style="font-size: 10px;"></span>
                                </div>
                                <div class="mb-1">
                                    <label for="zip_code" class="form-label">ZIP Code</label>
                                    <input type="text" class="form-control" id="zip_code" name="zip_code" required>
                                    <span id="zipCodeError" class="text-danger" style="font-size: 10px;"></span>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary mt-3" name="address_save_button">Save Address</button>

                        </form>
                    </div>
                </div>
            </div>
               
        </div>
    </div>
</div>


        <!-- Footer -->
    <footer class="footer mt-5 py-3 bg-dark">
        <div class="container text-center">
        <div class="row text-center text-md-left align-items-center">
            <div class="col-md-5">
            <p class="text-light">Copyright @2023 All rights are preserved</p>
            </div>
            <div class="col-md-7">
            <a href="#" class="social-icons text-white"><i class="fab fa-facebook-f"></i></a>
            <span class="mx-2"></span> <!-- Add space between icons using a span element with margin -->
            <a href="#" class="social-icons text-white"><i class="fab fa-twitter"></i></a>
            <span class="mx-2"></span> <!-- Add space between icons -->
            <a href="#" class="social-icons text-white"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
        </div>
    </footer>
  <!-- Footer -->
 
<!-- Add this JavaScript code to your template -->
<!-- <script>
    
    function validateInput(event) {
        const buildingNameInput = document.getElementById('building_name');
        const addressTypeInput = document.getElementById('address_type');
        const streetInput = document.getElementById('street');
        const cityInput = document.getElementById('city');
        const stateInput = document.getElementById('state');
        const zipCodeInput = document.getElementById('zip_code');

        const buildingNameError = document.getElementById('buildingNameError');
        const addressTypeError = document.getElementById('addressTypeError');
        const streetError = document.getElementById('streetError');
        const cityError = document.getElementById('cityError');
        const stateError = document.getElementById('stateError');
        const zipCodeError = document.getElementById('zipCodeError');

        // Check if any of the fields are empty or contain only spaces
        if (
            buildingNameInput.value.trim() === '' ||
            addressTypeInput.value === '' ||
            streetInput.value.trim() === '' ||
            cityInput.value.trim() === '' ||
            stateInput.value.trim() === '' ||
            zipCodeInput.value.trim() === ''
        ) {
            // Display error messages
            buildingNameError.textContent = 'Building Name is required';
            addressTypeError.textContent = 'Address Type is required';
            streetError.textContent = 'Street is required';
            cityError.textContent = 'City is required';
            stateError.textContent = 'State is required';
            zipCodeError.textContent = 'ZIP Code is required';

            // Prevent form submission
            event.preventDefault();
        } else {
            // Clear error messages
            buildingNameError.textContent = '';
            addressTypeError.textContent = '';
            streetError.textContent = '';
            cityError.textContent = '';
            stateError.textContent = '';
            zipCodeError.textContent = '';
        }
    }

    // Add the event listener to the form submission
    document.getElementById('address-form').addEventListener('submit', validateInput);
</script> -->



<script>
    // Function to show the edit address form and populate it with data
    function showEditAddressForm(addressData) {
        // Hide the address card display
        document.getElementById("address-card-display").style.display = "none";
        document.getElementById("add-address-btn").style.display = "none";
        // Show the edit address form
        var editAddressForm = document.getElementById("edit-address-form");
        editAddressForm.style.display = "block";

        // Populate the form fields with address data
        document.getElementById("address_id").value = addressData.address_id;
        document.getElementById("building_name").value = addressData.building_name;
        document.getElementById("address_type").value = addressData.address_type;
        document.getElementById("street").value = addressData.street;
        document.getElementById("city").value = addressData.city;
        document.getElementById("state").value = addressData.state;
        document.getElementById("zip_code").value = addressData.zip_code;
    }

    // Attach click event listeners to the edit buttons
    var editButtons = document.querySelectorAll('.edit-address-button');
    editButtons.forEach(function(button) {
        button.addEventListener('click', function() {
            // Extract the address data from the data attributes
            var addressData = {
                address_id: button.getAttribute('data-address-id'),
                building_name: button.getAttribute('data-building-name'),
                address_type: button.getAttribute('data-address-type'),
                street: button.getAttribute('data-street'),
                city: button.getAttribute('data-city'),
                state: button.getAttribute('data-state'),
                zip_code: button.getAttribute('data-zip-code')
            };
            showEditAddressForm(addressData);
        });
    });
    
</script>


<script>
    function deleteAddress(addressId) {
        $.ajax({
            type: "POST",
            url: "{% url 'delete_address' 0 %}".replace('0', addressId),  // Replace '0' with the actual address ID
            data: {
                csrfmiddlewaretoken: "{{ csrf_token }}",  // Include the CSRF token
            },
            success: function (response) {
                if (response.success) {
                    // Address deleted successfully, update the display
                    $("#address-card-" + addressId).remove();
                } else {
                    // Handle the case where deletion failed (optional)
                    console.log("Deletion failed");
                }
            },
            error: function () {
                // Handle errors (optional)
                console.log("Error occurred");
            },
        });
    }
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // Function to send an AJAX request to update the address
    function updateAddressViaAjax(formData) {
        $.ajax({
            type: 'POST',
            url: '{% url "update_address" %}', // Replace with the URL of your update_address view
            data: formData,
            dataType: 'json',
            success: function (response) {
                if (response.success) {
                    // Address updated successfully, close the edit form
                    document.getElementById("edit-address-form").style.display = "none";
                    document.getElementById("address-card-display").style.display = "flex"; 
                    document.getElementById("add-address-btn").style.display = "flex";
                    // The URL-encoded form data string

                    // Split the string into key-value pairs
                    var keyValuePairs = formData.split('&');

                    // Initialize an empty JSON object
                    var formDataRes = {};

                    // Loop through the key-value pairs and add them to the JSON object
                    for (var i = 0; i < keyValuePairs.length; i++) {
                        var keyValue = keyValuePairs[i].split('=');
                        var key = decodeURIComponent(keyValue[0]);
                        var value = decodeURIComponent(keyValue[1]);
                        formDataRes[key] = value;
                    }


                    // Parse the response JSON data
                    var updatedData = response.updated_data;
                    console.log(updatedData);
                    // Update the content of the address card on the page
                    var addressCard = document.getElementById("address-card-" + formDataRes.address_id);
                    addressCard.querySelector("strong").textContent = formDataRes.address_type;
                    addressCard.querySelector("#card_building").textContent = "Building: " + formDataRes.building_name;
                    addressCard.querySelector("#card_street").textContent = "Street: " + formDataRes.street;
                    addressCard.querySelector("#card_city").textContent = "City: " + formDataRes.city;
                    addressCard.querySelector("#card_zip-code").textContent = "Zip Code: " + formDataRes.zip_code;
                } else {
                    // Handle errors if needed
                    console.error('Error updating address');
                }
            },
            error: function () {
                // Handle errors if needed
                console.error('Error updating address');
            },
        });
    }

    // Attach a submit event listener to the update form
    var updateForm = document.getElementById('update-form');
    updateForm.addEventListener('submit', function (e) {
        e.preventDefault(); // Prevent the default form submission
        var formData = $(this).serialize(); // Serialize the form data
        updateAddressViaAjax(formData); // Send the AJAX request to update the address
    });
});

</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Function to send an AJAX request to update the address
        function addAddressViaAjax(formData) {
            $.ajax({
                type: 'POST',
                url: '{% url "update_address" %}', // Replace with the URL of your update_address view
                data: formData,
                dataType: 'json',
                success: function (response) {
                    if (response.success) {
                        // Address updated successfully, close the edit form
                        document.getElementById("edit-address-form").style.display = "none";
                        document.getElementById("address-card-display").style.display = "flex"; 
                        document.getElementById("add-address-btn").style.display = "flex";
                        // The URL-encoded form data string
    
                        // Split the string into key-value pairs
                        var keyValuePairs = formData.split('&');
    
                        // Initialize an empty JSON object
                        var formDataRes = {};
    
                        // Loop through the key-value pairs and add them to the JSON object
                        for (var i = 0; i < keyValuePairs.length; i++) {
                            var keyValue = keyValuePairs[i].split('=');
                            var key = decodeURIComponent(keyValue[0]);
                            var value = decodeURIComponent(keyValue[1]);
                            formDataRes[key] = value;
                        }
    
    
                        // Parse the response JSON data
                        var updatedData = response.updated_data;
                        console.log(updatedData);
                        // Update the content of the address card on the page
                        var addressCard = document.getElementById("address-card-" + formDataRes.address_id);
                        addressCard.querySelector("strong").textContent = formDataRes.address_type;
                        addressCard.querySelector("#card_building").textContent = "Building: " + formDataRes.building_name;
                        addressCard.querySelector("#card_street").textContent = "Street: " + formDataRes.street;
                        addressCard.querySelector("#card_city").textContent = "City: " + formDataRes.city;
                        addressCard.querySelector("#card_zip-code").textContent = "Zip Code: " + formDataRes.zip_code;
                    } else {
                        // Handle errors if needed
                        console.error('Error updating address');
                    }
                },
                error: function () {
                    // Handle errors if needed
                    console.error('Error updating address');
                },
            });
        }
    
        // Attach a submit event listener to the update form
        var updateForm = document.getElementById('update-form');
        updateForm.addEventListener('submit', function (e) {
            e.preventDefault(); // Prevent the default form submission
            var formData = $(this).serialize(); // Serialize the form data
            updateAddressViaAjax(formData); // Send the AJAX request to update the address
        });
    });  
    
    </script>


<script>
    function showAddressForm() {
        var addressFormContainer = document.getElementById("address-cards-container");
        var showAddressFormButton = document.getElementById("show-address-form-button");
        var addressCardDisplay = document.getElementById("address-card-display");
        console.log(addressCardDisplay);
        if (addressFormContainer.style.display === "none" || addressFormContainer.style.display === "") {
            addressFormContainer.style.display = "block";
            showAddressFormButton.textContent = "Hide Form";
            
            // Hide the address card display
            addressCardDisplay.style.display = "none";
        } else {
            addressFormContainer.style.display = "none";
            showAddressFormButton.textContent = "Add Address";
            
            // Show the address card display
            addressCardDisplay.style.display = "flex";
        }
    }

    // Add an event listener to the "Add Address" button
    var showAddressFormButton = document.getElementById("show-address-form-button");
    showAddressFormButton.addEventListener("click", showAddressForm);

    // Function to show the address card section
    function showAddressCards() {
        var profileFormSection = document.getElementById("profile-form-section");
        var addressFormCardTemplate = document.getElementById("address-form-card-template");
        var addressCardDisplay = document.getElementById("address-card-display");

        profileFormSection.style.display = "none";
        addressFormCardTemplate.style.display = "block";
        addressCardDisplay.style.display = "flex"; // Hide the address card display
    }

    // Function to show the profile form section
    function showProfileForm() {
        var profileFormSection = document.getElementById("profile-form-section");
        var addressFormCardTemplate = document.getElementById("address-form-card-template");
        var addressCardDisplay = document.getElementById("address-card-display");

        // Hide the address card template
        addressFormCardTemplate.style.display = "none";

        // Show the profile form section
        profileFormSection.style.display = "block";

        // Show the address card display
        addressCardDisplay.style.display = "flex";
    }
</script>

<!-- ... Rest of your HTML ... -->

  <script>
    // Add event listeners for input fields
    const firstNameInput = document.querySelector('input[name="first_name"]');
    const lastNameInput = document.querySelector('input[name="last_name"]');
    const mobileNumberInput = document.querySelector('input[name="mobile_number"]');
    const saveButton = document.querySelector('button#save_button');
    const updateButton = document.querySelector('button#update_button');

    firstNameInput.addEventListener('input', validateForm);
    lastNameInput.addEventListener('input', validateForm);
    mobileNumberInput.addEventListener('input', validateForm);

    function enableInputs(enable) {
        [firstNameInput, lastNameInput, mobileNumberInput].forEach((input) => {
            input.disabled = !enable;
        });
    }

    updateButton.addEventListener('click', function (event) {
        event.preventDefault(); // Prevent the form from submitting

        // Enable input fields except for email
        enableInputs(true);

        // Disable the email field
        emailInput.disabled = true;
    });

    function validateForm() {
    const firstName = firstNameInput.value.trim();
    const lastName = lastNameInput.value.trim();
    let mobileNumber = mobileNumberInput.value.trim();
    const firstNameError = document.getElementById('first_name_error');
    const lastNameError = document.getElementById('last_name_error');
    const mobileNumberError = document.getElementById('mobile_number_error');

    // Validate First Name
    if (firstName === '') {
        firstNameError.textContent = 'First Name is required';
    } else if (!/^[a-zA-Z]+$/.test(firstName)) {
        firstNameError.textContent = 'Only alphabets are allowed';
    } else {
        firstNameError.textContent = '';
    }

    // Validate Last Name
    if (lastName === '') {
        lastNameError.textContent = 'Last Name is required';
    } else if (!/^[a-zA-Z ]+$/.test(lastName)) {
        lastNameError.textContent = 'Only alphabets are allowed';
    } else {
        lastNameError.textContent = '';
    }

    // Only validate and format Mobile Number if it's changed from the existing value
    if (mobileNumber !== '{{ user_profile.mobile_number }}') {
        // Remove spaces and non-digit characters from mobile number except '+'
        mobileNumber = mobileNumber.replace(/[^+\d]/g, '');

        // Automatically add "+91" in front of mobile number if it has 10 digits
        if (mobileNumber.length === 10) {
            mobileNumber = '+91' + mobileNumber;
        }

        // Validate Mobile Number
        if (mobileNumber === '') {
            mobileNumberError.textContent = 'Mobile Number is required';
        } else if (!/^\+91\d{10}$/.test(mobileNumber)) {
            mobileNumberError.textContent = 'Mobile Number must start with +91 and have 10 digits';
        } else {
            mobileNumberError.textContent = '';
        }

        // Update the input field with the formatted mobile number
        mobileNumberInput.value = mobileNumber;
    } else {
        mobileNumberError.textContent = ''; // Clear error for existing value
    }

    // Enable or disable buttons based on validation
    if (firstName !== '' && /^[a-zA-Z]+$/.test(firstName) &&
        lastName !== '' && /^[a-zA-Z ]+$/.test(lastName) &&
        (mobileNumber === '{{ user_profile.mobile_number }}' || /^\+91\d{10}$/.test(mobileNumber))) {
        saveButton.disabled = false;
        updateButton.disabled = false;
    } else {
        saveButton.disabled = true;
        updateButton.disabled = true;
    }
}
</script>

  <!-- Include jQuery library -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
$(document).ready(function() {
    // Handle the form submission
    $("#search-form").submit(function(event) {
        event.preventDefault(); // Prevent the default form submission

        // Get the search query from the input field
        var query = $("#inputModalSearch").val();

        // Send an AJAX request to the Django view
        $.ajax({
            type: "GET",
            url: "/search/", // URL should match the URL pattern in your urls.py
            data: {'q': query},
            dataType: "json",
            success: function(response) {
                // Handle the response and update the search results container
                var results = response.results;
                console.log(results)
                var resultHtml = '';

                if (results.length === 0) {
                    resultHtml = '<p>No results found.</p>';
                } else {
                    for (var i = 0; i < results.length; i++) {
                        // Construct the URLs for product name and category

                        console.log(results[i])
                        var productNameUrl = "/customer_ProductView/" + results[i].id+ "/";
                        var categoryUrl = "/customer_allProducts/?category=" + results[i].product_category;
                        
                        // Create clickable links for product name and category
                        resultHtml += '<a style="z-index:7" href="' + productNameUrl + '">' + results[i].product_name + '</a> - <a href="' + categoryUrl + '">' + results[i].product_category + '</a><br>';
                    }
                }

                // Update the search results container
                $("#search-results").html(resultHtml);
            }
        });
    });
    // Clear search results and input when the modal is hidden
    $("#templatemo_search").on("hidden.bs.modal", function () {
        $("#search-results").empty();
        $("#inputModalSearch").val('');
    });

    // Clear search input when the dropdown is closed or when clicking outside the dropdown
    $(document).on('click', function (e) {
        if (!$(e.target).closest('.dropdown-menu').length) {
            // Clicked outside the dropdown
            $("#inputModalSearch").val('');
            $("#search-results").empty();
        }
    });
});

  
  </script>

    <!-- Start Script -->
    <script src="{% static 'js/jquery-1.11.0.min.js' %}"></script>
    <script src="{% static 'js/jquery-migrate-1.2.1.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'js/templatemo.js' %}"></script>
    <script src="{% static 'js/custom.js' %}"></script>
    <!-- End Script -->
</body>

</html>